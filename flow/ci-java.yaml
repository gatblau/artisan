---
name: Java Application Builder
description: Builds a Artisan content package for a Java Application
input:
  - name: ART_REG_DOMAIN
    description: the artisan registry domain
    required: true
    type: string
secret:
  - name: PK_KEY
    description: the private PGP key used to sign the java package
    mount: /keys/root_rsa_key.pgp
  - name: PUB_KEY
    description: the public PGP key used to open the Sonar scanner executable package
    mount: /keys/root_rsa_pub.pgp
  - name: ART_REG_USER
    description: the artisan registry user
  - name: ART_REG_PWD
    description: the artisan registry password
steps:
  - name: build-app
    runtime: quay.io/gatblau/art-java
    command: art run build-app
  - name: scan-app
    runtime: quay.io/gatblau/art-sonar
    command: art exec ${ART_REG_DOMAIN}/library/sonar-scanner scan-app -u=${ART_REG_USER}:${ART_REG_PWD} -p=/keys/root_rsa_pub.pgp
  - name: package-app
    runtime: quay.io/gatblau/art-java
    command: art run publish-app
...